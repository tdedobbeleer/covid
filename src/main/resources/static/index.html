<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
    <script crossorigin="anonymous"
            integrity="sha512-vBmx0N/uQOXznm/Nbkp7h0P1RfLSj0HQrFSzV8m7rOGyj30fYAOKHYvCNez+yM8IrfnW0TCodDEjRqf6fodf/Q=="
            src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"></script>
    <script
            crossorigin="anonymous"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script crossorigin="anonymous" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

    <link crossorigin="anonymous" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.css"
          integrity="sha512-SUJFImtiT87gVCOXl3aGC00zfDl6ggYAw5+oheJvRJ8KBXZrr/TMISSdVJ5bBarbQDRC2pR5Kto3xTR0kpZInA=="
          rel="stylesheet"/>
    <link crossorigin="anonymous" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
          integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/gh/xcash/bootstrap-autocomplete@v2.3.7/dist/latest/bootstrap-autocomplete.min.js"></script>
    <title>Covid Bel</title>
</head>

<body>


<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <button aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"
            class="navbar-toggler" data-target="#navbarSupportedContent" data-toggle="collapse" type="button">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
            <li aria-controls="collapseCasesPerDay" aria-expanded="false" class="nav-item active"
                data-toggle="collapse" href="#collapseCasesPerDay">
                <a class="nav-link" href="#">Cases per day</a>
            </li>
            <li aria-controls="collapseCasesPerDayForProvince" aria-expanded="false" class="nav-item"
                data-toggle="collapse" href="#collapseCasesPerDayForMunicipality">
                <a class="nav-link" href="#">Cases per city</a>
            </li>
            <li aria-controls="collapseCasesPerDayForProvince" aria-expanded="false" class="nav-item"
                data-toggle="collapse" href="#collapseCasesPerDayForProvince">
                <a class="nav-link" href="#">Cases per province</a>
            </li>
        </ul>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <main class="col-12 pt-3 px-4" id="collapseParent" role="main">
            <div class="chartjs-size-monitor"
                 style="position: absolute; left: 0px; top: 0px; right: 0px; bottom: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;">
                <div class="chartjs-size-monitor-expand"
                     style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;">
                    <div style="position:absolute;width:1000000px;height:1000000px;left:0;top:0"></div>
                </div>
                <div class="chartjs-size-monitor-shrink"
                     style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;">
                    <div style="position:absolute;width:200%;height:200%;left:0; top:0"></div>
                </div>
            </div>
            <div class="collapse show" data-parent="#collapseParent" id="collapseCasesPerDay">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
                    <h1 class="h2">Cases per day</h1>
                </div>
                <div class="align-items-center text-center">
                    <div class="spinner-border text-primary text-center" id="totalPerDayChartStatus" role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                </div>

                <canvas class="my-4 chartjs-render-monitor" height="649" id="totalPerDayChart"
                        style="display: block; width: 1538px; height: 649px;" width="1538"></canvas>
            </div>

            <div class="collapse" data-parent="#collapseParent" id="collapseCasesPerDayForMunicipality">
                <div class="pb-2 mb-3 border-bottom">
                    <h1 class="h2">Cases per day for a municipality</h1>
                    <div class="form-group w-100">
                        <label for="municipalityAutoComplete">City</label>
                        <input aria-describedby="municipalityAutoCompleteHelp" autocomplete="off"
                               class="municipalityAutoComplete form-control" id="municipalityAutoComplete" type="text">
                        <small class="form-text text-muted" id="municipalityAutoCompleteHelp">Start tying to
                            search.</small>
                    </div>

                </div>
                <div class="align-items-center text-center">
                    <div class="spinner-border text-primary text-center" id="totalPerDayForMunicipalityStatus"
                         role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                </div>

                <canvas class="my-4 chartjs-render-monitor" height="649" id="totalPerDayForMunicipalityChart"
                        style="display: block; width: 1538px; height: 649px;" width="1538"></canvas>
            </div>

            <div class="collapse" data-parent="#collapseParent" id="collapseCasesPerDayForProvince">
                <div class="pb-2 mb-3 border-bottom">
                    <h1 class="h2">Cases per day for a province</h1>
                    <div class="form-group  w-100">
                        <label for="provinceAutoComplete">Province</label>
                        <input aria-describedby="provinceAutoCompleteHelp" autocomplete="off"
                               class="provinceAutoComplete form-control" id="provinceAutoComplete" type="text">
                        <small class="form-text text-muted" id="provinceAutoCompleteHelp">Start tying to search.</small>
                    </div>

                </div>
                <div class="align-items-center text-center">
                    <div class="spinner-border text-primary text-center" id="totalPerDayForProvinceStatus"
                         role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                </div>

                <canvas class="my-4 chartjs-render-monitor" height="649" id="totalPerDayForProvinceChart"
                        style="display: block; width: 1538px; height: 649px;" width="1538"></canvas>
            </div>

        </main>
    </div>
</div>

<script>
    (function ($) {
        var totalPerDayChartStatus = $("#totalPerDayChartStatus");
        var municipalityAutoComplete = $(".municipalityAutoComplete");
        var totalPerDayForMunicipalityStatus = $("#totalPerDayForMunicipalityStatus");
        var totalPerDayForMunicipalityChart;
        var provinceAutoComplete = $(".provinceAutoComplete");
        var totalPerDayForProvinceStatus = $("#totalPerDayForProvinceStatus");
        var totalPerDayForProvinceChart;

        totalPerDayChartStatus.show();
        totalPerDayForMunicipalityStatus.hide();
        totalPerDayForProvinceStatus.hide();

        function createTotalPerDayChart(json) {
            var labels = [];
            var data = [];
            process(labels, data, json);

            var ctx = $("#totalPerDayChart");
            var myLineChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total infections per day',
                        data: data,
                        backgroundColor: 'rgba(0, 119, 204, 0.3)'
                    }]
                }
            });
            totalPerDayChartStatus.hide();
        }

        function createTotalPerDayForMunicipality(json, municipality) {
            if (totalPerDayForMunicipalityChart !== undefined) {
                totalPerDayForMunicipalityChart.destroy();
            }
            var labels = [];
            var data = [];

            process(labels, data, json);

            totalPerDayForMunicipalityChart = new Chart($("#totalPerDayForMunicipalityChart"), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total infections for city of ' + municipality,
                        data: data,
                        backgroundColor: 'rgba(0, 119, 204, 0.3)'
                    }]
                }
            });
            totalPerDayForMunicipalityStatus.hide();
        }

        function createTotalPerDayForProvince(json, province) {
            if (totalPerDayForProvinceChart !== undefined) {
                totalPerDayForProvinceChart.destroy();
            }
            var labels = [];
            var data = [];

            process(labels, data, json);

            totalPerDayForProvinceChart = new Chart($("#totalPerDayForProvinceChart"), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Total infections for province ' + province,
                        data: data,
                        backgroundColor: 'rgba(0, 119, 204, 0.3)'
                    }]
                }
            });
            totalPerDayForProvinceStatus.hide();
        }

        function process(labels, data, json) {
            for (var i = 0; i < json.length; i++) {
                labels.push(json[i].date.slice(5));
                data.push(json[i].total);
            }
        }


        $.getJSON("/api/stats/day", createTotalPerDayChart);
        //$.getJSON("/api/stats/municipality", createTotalPerDayChart);

        municipalityAutoComplete.autoComplete({
            resolverSettings: {
                url: '/api/data/municipalities'
            }
        });

        municipalityAutoComplete.on('autocomplete.select', function (evt, item) {
            $.getJSON("/api/stats/day/municipalities/" + item, function (json) {
                createTotalPerDayForMunicipality(json, item);
            });
        });

        municipalityAutoComplete.change(function () {
            totalPerDayForMunicipalityStatus.show();
        });

        provinceAutoComplete.autoComplete({
            resolverSettings: {
                url: '/api/data/provinces'
            }
        });

        provinceAutoComplete.on('autocomplete.select', function (evt, item) {
            $.getJSON("/api/stats/day/provinces/" + item, function (json) {
                createTotalPerDayForProvince(json, item);
            });
        });

        provinceAutoComplete.change(function () {
            totalPerDayForProvinceStatus.show();
        });

    })(jQuery);
</script>
</body>
</html>